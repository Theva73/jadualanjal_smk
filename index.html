<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jadual Anjal â€” Module Base</title>
  <link rel="stylesheet" href="./assets/styles.css" />
</head>
<body>
  <div class="main-container">
    <h2 id="scheduleTitle" contenteditable="true">Jadual Anjal</h2>
    <div id="userIdDisplay">User ID: Loading...</div>

    <!-- Top action bar -->
    <div id="topActionButtonsBar">
      <button id="controlsToggler" class="top-action-btn" aria-expanded="false" aria-controls="collapsibleButtonBars">Show Controls</button>
      <button id="manualSaveBtn" class="top-action-btn">Save Page</button>
      <button id="downloadPdfBtn" class="top-action-btn">PDF</button>
      <button id="clearScheduledNamesBtn" class="top-action-btn">Clear Names (All Tables)</button>
    </div>

    <!-- Collapsible toolbars -->
    <div id="collapsibleButtonBars" class="open">
      <div class="bar">
        <button id="directCopyFullHtmlBtn">ğŸ“‹ Copy HTML</button>
      </div>
      <div class="bar">
        <button id="excelBtnTrigger">ğŸ’¾ Export Excel</button>
        <button id="importExcelBtn">ğŸ“‚ Import Excel</button>
        <input type="file" id="fileInput" accept=".xlsx, .xls" style="display:none" />
      </div>
      <div class="bar">
        <button id="saveSharedScheduleBtn">ğŸ’  Save Shared</button>
        <button id="loadSharedScheduleBtn">â˜ï¸ Load Shared</button>
        <button id="restoreBackupBtn">ğŸ›¡ï¸ Restore Backup</button>
        <button id="exportSharedSchedulesBtn">ğŸ“¤ Export All</button>
        <button id="importSharedSchedulesBtn">ğŸ“¥ Import All</button>
        <input type="file" id="sharedScheduleImportFile" accept=".json" style="display:none" />
        <button id="clearAndResetScheduleBtn">ğŸ§¹ Clear & New</button>
      </div>
      <div class="bar">
        <button id="selectBtn">âœ¨ Select Cells</button>
        <button id="mergeBtn">ğŸ”— Merge</button>
        <button id="deselectBtn">ğŸš« Deselect</button>
        <button id="unmergeBtn">ğŸ’” Unmerge</button>
      </div>
      <div class="bar">
        <button id="addTableBtn">â• Add Table</button>
        <button id="addIndependentTableBtn">â• Add Standalone Table</button>
        <button id="renameTableBtn">ğŸ“ Rename Table</button>
        <button id="deleteTableBtn">âŒ Delete Table</button>
        <!-- IMPORTANT: Name List Manager is now a separate page -->
        <a class="link-btn" href="./names.html" target="_blank" rel="noopener">ğŸ‘¥ Open Name List Manager</a>
      </div>
    </div>

    <div class="bar table-tabs" id="tableTabs"></div>

    <div id="tablesContainer">
      <!-- Starter table -->
      <table id="tbl_1" class="active" data-table-name="Kelas 3 & 5">
        <thead>
          <tr class="date-header-row">
            <th class="date-header-cell" contenteditable="true">Thursday, 22 May 2025</th>
            <th class="date-header-cell" contenteditable="true"></th>
            <th class="date-header-cell" contenteditable="true"></th>
            <th class="date-header-cell" contenteditable="true"></th>
            <th class="date-header-cell" contenteditable="true"></th>
            <th class="date-header-cell" contenteditable="true"></th>
            <th class="date-header-cell" contenteditable="true"></th>
            <th class="date-header-cell" contenteditable="true"></th>
          </tr>
          <tr>
            <th contenteditable="true">Class</th>
            <th contenteditable="true">08:00</th>
            <th contenteditable="true">09:00</th>
            <th contenteditable="true">10:00</th>
            <th contenteditable="true">11:00</th>
            <th contenteditable="true">12:00</th>
            <th contenteditable="true">13:00</th>
            <th contenteditable="true">14:00</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">5S1</td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td contenteditable="true">5S2</td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3 style="margin-top: 32px">Teacher/Subject Attendance Summary</h3>
    <div id="summaryTableContainer">
      <table id="summaryTable"></table>
    </div>

    <div id="customMessageBox" class="custom-message-box"></div>
    <div id="generalLoadingIndicator" style="display:none;"><div class="spinner"></div></div>
  </div>

  <!-- PDF stub -->
  <div id="pdfContent" style="display:none;"></div>

  <!-- InteractJS (for future drag/resize; optional) -->
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

  <!-- App modules -->
  <script type="module">
    import { initFirebase } from './js/firebase.js';
    import { ensureAnonymousAuth, onAuthReady } from './js/auth.js';
    import { initScheduleUI } from './js/schedule_ui.js';
    import { loadNamesForSession } from './js/names_store.js';

    // Initialize Firebase
    initFirebase();

    // Sign-in anonymously then boot the UI
    ensureAnonymousAuth();
    onAuthReady(async (user) => {
      const uid = user ? user.uid : 'UNKNOWN';
      const el = document.getElementById('userIdDisplay');
      if (el) el.textContent = 'User ID: ' + uid;

      // optional: preload pagi names for autocomplete hooks
      try {
        await loadNamesForSession('pagi');
      } catch (e) {
        console.warn('Preload names failed:', e);
      }

      // init schedule UI (basic wiring; extend as needed)
      initScheduleUI();
    });
  </script>
</body>
</html>
