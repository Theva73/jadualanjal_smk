<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Database Cleaner</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
    <div id="status" class="text-2xl font-bold text-gray-700">Initializing...</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBgvyb95-jujtCC2HPiHXLdYMJgQquIEx4",
      authDomain: "jadual-3f0aa.firebaseapp.com",
      projectId: "jadual-3f0aa",
      storageBucket: "jadual-3f0aa.firebasestorage.app",
      messagingSenderId: "496526436851",
      appId: "1:496526436851:web:78ff48b28bfc8c31f14a86"
    };

    async function cleanCollection(db, collectionName) {
        const statusEl = document.getElementById('status');
        if (!confirm(`Are you sure you want to PERMANENTLY DELETE ALL documents in the '${collectionName}' collection? This cannot be undone.`)) {
            statusEl.innerHTML += `<p class="text-yellow-500 text-lg">Skipped '${collectionName}'.</p>`;
            return;
        }
        
        statusEl.innerHTML += `<p class="text-blue-500 text-lg">Cleaning ${collectionName}...</p>`;
        const querySnapshot = await getDocs(collection(db, collectionName));
        if (querySnapshot.empty) {
            statusEl.innerHTML += `<p class="text-gray-500 text-lg">'${collectionName}' is already empty.</p>`;
            return;
        }

        const batch = writeBatch(db);
        querySnapshot.forEach(doc => {
            batch.delete(doc.ref);
        });
        await batch.commit();
        statusEl.innerHTML += `<p class="text-green-500 text-lg">Successfully deleted ${querySnapshot.size} documents from ${collectionName}.</p>`;
    }

    async function main() {
        const statusEl = document.getElementById('status');
        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            statusEl.textContent = 'Connected to Database. Starting cleanup...';
            
            await cleanCollection(db, 'subjects');
            await cleanCollection(db, 'classes');
            await cleanCollection(db, 'locations');

            statusEl.innerHTML += '<p class="text-2xl font-bold text-green-600 mt-4">✅ All collections cleaned! You can now use the final script.</p>';
        } catch (error) {
            console.error("Cleanup failed:", error);
            statusEl.textContent = `❌ Error during cleanup: ${error.message}`;
            statusEl.classList.add('text-red-500');
        }
    }

    main();
</script>
</body>
</html>


